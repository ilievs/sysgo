package proc

import (
	"github.com/ilievss/sysgo/testhelp"
	"testing"
)

var statFileContent = `cpu  703790 1526 124713 11576192 3687 0 255 0 0 0
cpu0 88782 121 16106 1446620 51 0 93 0 0 0
cpu1 89999 519 15030 1443494 3134 0 112 0 0 0
cpu2 86042 275 16738 1447416 139 0 31 0 0 0
cpu3 89966 86 14000 1448142 89 0 9 0 0 0
cpu4 89068 90 15022 1447312 74 0 5 0 0 0
cpu5 83720 161 16200 1447903 72 0 0 0 0 0
cpu6 87538 80 15913 1448266 72 0 2 0 0 0
cpu7 88673 192 15700 1447034 53 0 1 0 0 0
intr 14430596 9 295 0 0 0 0 0 0 1 914 0 0 168 0 0 0 301 0 0 0 0 0 0 29 105380 19 0 124444 907147 15 801342 828 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
ctxt 70941406
btime 1561877542
processes 57550
procs_running 1
procs_blocked 0
softirq 12646390 89 4321784 998 2481 112033 0 6443 4731262 0 3471300
`

func TestParseStatFileContent(t *testing.T) {

	statInfo := parseStatFileContent(statFileContent)

	testhelp.Equal(t, StatInfo{
		CpuTimeSpentStates{703790, 1526, 124713, 11576192, 3687, 0, 255, 0, 0, 0},
		[]CpuTimeSpentStates{
			{88782, 121, 16106, 1446620, 51, 0, 93, 0, 0, 0},
			{89999, 519, 15030, 1443494, 3134, 0, 112, 0, 0, 0},
			{86042, 275, 16738, 1447416, 139, 0, 31, 0, 0, 0},
			{89966, 86, 14000, 1448142, 89, 0, 9, 0, 0, 0},
			{89068, 90, 15022, 1447312, 74, 0, 5, 0, 0, 0},
			{83720, 161, 16200, 1447903, 72, 0, 0, 0, 0, 0},
			{87538, 80, 15913, 1448266, 72, 0, 2, 0, 0, 0},
			{88673, 192, 15700, 1447034, 53, 0, 1, 0, 0, 0}},
		14430596,
		70941406,
		1561877542,
		57550,
		1,
		0,
		12646390,
	}, statInfo)
}

func BenchmarkParseStatFileContent(b *testing.B) {
	for i := 0; i < b.N; i++ {
		parseStatFileContent(statFileContent)
	}
}
